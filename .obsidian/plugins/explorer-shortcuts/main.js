/*
THIS IS A GENERATED/BUNDLED FILE BY ESBUILD
if you want to view the source, please visit the github repository of this plugin
*/
var de=Object.create;var F=Object.defineProperty;var he=Object.getOwnPropertyDescriptor;var xe=Object.getOwnPropertyNames;var Ee=Object.getPrototypeOf,ve=Object.prototype.hasOwnProperty;var ge=(e,r)=>{for(var t in r)F(e,t,{get:r[t],enumerable:!0})},K=(e,r,t,o)=>{if(r&&typeof r=="object"||typeof r=="function")for(let n of xe(r))!ve.call(e,n)&&n!==t&&F(e,n,{get:()=>r[n],enumerable:!(o=he(r,n))||o.enumerable});return e};var V=(e,r,t)=>(t=e!=null?de(Ee(e)):{},K(r||!e||!e.__esModule?F(t,"default",{value:e,enumerable:!0}):t,e)),ye=e=>K(F({},"__esModule",{value:!0}),e);var Ve={};ge(Ve,{default:()=>k});module.exports=ye(Ve);var ue=require("obsidian");var H={focusNeeded:!0,delConfirmFile:!1,delConfirmFolder:!0};var y=require("obsidian"),b=class extends y.PluginSettingTab{constructor(t,o){super(t,o);this.plugin=o;this.plugin=o}display(){let{containerEl:t}=this;t.empty(),new y.Setting(t).setName("Confirm before deleting files").addToggle(o=>o.setValue(this.plugin.settings.delConfirmFile).onChange(async n=>{this.plugin.settings.delConfirmFile=n,await this.plugin.saveSettings()})),new y.Setting(t).setName("Confirm before deleting folders").addToggle(o=>o.setValue(this.plugin.settings.delConfirmFolder).onChange(async n=>{this.plugin.settings.delConfirmFolder=n,await this.plugin.saveSettings()}))}};var E=V(require("path"));function u(e){var r,t,o;return(o=(t=(r=e==null?void 0:e.children[0])==null?void 0:r.getAttribute("data-path"))!=null?t:e==null?void 0:e.getAttribute("data-path"))!=null?o:""}function p(e){return e.explorerfileContainer||e.explorerfolderContainer||null}function R(e,r){return e.mousePosition={x:r.clientX,y:r.clientY},e.mousePosition?document.elementFromPoint(e.mousePosition.x,e.mousePosition.y):null}function T(e,r){var t;return(t=e==null?void 0:e.classList.contains(r))!=null?t:!1}var U=e=>T(e,"nav-file"),L=e=>T(e,"is-collapsed"),B=e=>T(e,"nav-folder"),q=e=>{var r,t;return(t=(r=e.elementFromPoint)==null?void 0:r.closest(".nav-file"))!=null?t:null},j=e=>{var r,t;return(t=(r=e.elementFromPoint)==null?void 0:r.closest(".nav-folder"))!=null?t:null};function $(){return document.querySelectorAll(".nav-files-container .nav-file, .nav-files-container .nav-folder")}async function N(e){return new Promise(r=>{setTimeout(()=>{let t=we(e);if(!t)return r();t.scrollIntoView({behavior:"smooth",block:"center"}),r()},100)})}function d(e){var t;let r=(t=X(e))==null?void 0:t.view;return!r||!r.fileItems?[]:Object.entries(r.fileItems).slice(1)||[]}function G(e){var t;return(t=d(e).find(o=>o[1].selfEl.classList.contains("is-active")))!=null?t:null}function A(e,r){let t=u(r),o=d(e);if(o){for(let n of o)if(n[0].includes(t)){n[1].setCollapsed(!1,!0);break}}}var w=e=>{var t;return((t=e.elementFromPoint)==null?void 0:t.closest(".workspace-leaf-content[data-type='file-explorer'] .nav-files-container"))||null};function X(e){var t,o;let{workspace:r}=e.app;return(o=(t=r.getLeavesOfType("file-explorer"))==null?void 0:t.first())!=null?o:null}function v(e){let r=X(e);return r?r.view:null}function we(e){var t;let r=v(e);return(t=r==null?void 0:r.containerEl.querySelector(".is-active"))!=null?t:null}function Y(e){return{dir:E.dirname(e),name:E.basename(e,E.extname(e)),ext:E.extname(e)}}function _(e,r){e.operation=r;let t=p(e);if(!t)return;let o=r==="cut"?"copy":"cut";t.classList.contains(o)||t.classList.toggle(r)}function z(e){_(e,"copy")}function W(e){_(e,"cut")}function J(e){d(e).forEach(([t,o])=>{o.el.classList.remove("copy","cut")}),e.operation=null}var x=require("obsidian");var g=require("obsidian"),D=class extends g.Modal{constructor(t,o,n){super(t);this.message=o;this.callback=n;this.scope=new g.Scope(this.scope),this.scope.register([],"Enter",(s,i)=>{this.callback(!0),this.close()})}onOpen(){let{contentEl:t}=this;t.empty(),t.createEl("p").setText(this.message),new g.Setting(this.contentEl).addButton(o=>{o.setIcon("checkmark").setCta().onClick(()=>{this.callback(!0),this.close()})}).addExtraButton(o=>o.setIcon("cross").onClick(()=>{this.callback(!1),this.close()}))}onClose(){let{contentEl:t}=this;t.empty()}};async function Fe(e,r){return await new Promise(t=>{new D(e,r,o=>{t(o)}).open()})}async function I(e){return await Fe(this.app,e)}async function Z(e,r){let t=!0,o=v(e),n=o==null?void 0:o.tree;if(!n)return;let s=p(e),i=u(s)||"/",l=o.fileItems[i];if(!l)return;let a=l.file;if(a instanceof x.TFile&&l.el.children[0].classList.contains("has-focus")||(e.settings.delConfirmFile&&a instanceof x.TFile?t=await Q(a):e.settings.delConfirmFolder&&a instanceof x.TFolder&&(t=await Q(a)),!t))return;n.selectItem(l),n.handleDeleteSelectedItems(r);let c=a instanceof x.TFile?"File":"Folder";new x.Notice(`${c} removed: `+a.name,2e3)}async function Q(e){return I(" Are you sure you want to delete "+e.name+"?")}function ee(e,r){let t=new MouseEvent("mousemove",{clientX:e.mousePosition.x+1,clientY:e.mousePosition.y+1});setTimeout(()=>{document.dispatchEvent(t)},70)}var te=require("obsidian");async function O(e,r="down"){await be(e);let t=Ie(e,r);if(!t){new te.Notice("End of list",800);return}U(t)&&await Te(e,t)}async function be(e){let r=G(e);if(!r)return;let[t,o]=r;for(let n=0;n<2;n++){let s=d(e);for(let[i,l]of s)t.startsWith(i)&&L(l.el)&&l.setCollapsed(!1,!1);await new Promise(i=>setTimeout(i,50))}await N(e)}function Ie(e,r){let t=S();if(t.length===0)return;let o=Pe(t);if(o===-1){if(o=Se(e,t),o===-1)return;t=S()}return ke(e,t,o,r)}function Se(e,r){let t=d(e),o=e.app.workspace.getLeaf(!1);if(!(o!=null&&o.view.file))return-1;let n=o.view.file.path,s=t.find(l=>l[0]===n);return s?(A(e,s[1].el),S().findIndex(l=>l.children[0].classList.contains("is-active"))):-1}function S(){let e=$();return Array.from(e).filter(r=>!r.children[0].classList.contains("is-unsupported")&&!r.classList.contains("mod-root"))}function Pe(e){return e.findIndex(r=>r.children[0].classList.contains("is-active"))}function P(e,r,t){return t==="down"?(e+1)%r:(e-1+r)%r}function ke(e,r,t,o){let n=r,s=P(t,n.length,o),i=n[s];for(;B(i);){if(L(i)){let{newIndex:l,newList:a}=Ce(e,i,n,s,o);s=l,n=a}else s=P(s,n.length,o);i=n[s]}return i}function Ce(e,r,t,o,n){let s=t.length;A(e,r);let i=S(),a=i.length-s,c=i.indexOf(r),m;return n==="down"?m=a===0?P(o,i.length,n):c+1:m=a===0?P(o,i.length,n):c+a,{newIndex:m,newList:i}}async function Te(e,r){let t=u(r);if(!t)return;let o=e.app.vault.getFileByPath(t);if(!o)return;let n=e.app.workspace.getLeaf(!1);n&&(await n.openFile(o,{active:!0}),await N(e))}var re=require("obsidian");async function M(e,r){var a,c;let t=v(e);if(!t)return;let o=p(e),n=u(o)||"/",i=t.fileItems[n].file;if((i instanceof re.TFile?"file":"folder")==="file"){let m=(c=(a=i.parent)==null?void 0:a.path)!=null?c:"/";i=this.app.vault.getAbstractFileByPath(m)}t.createAbstractFile(r,i,!0)}var f=require("obsidian"),h=V(require("path"));async function ne(e){var s;let r=d(e),t=r.filter(i=>i[1].el.classList.contains("copy")),o=r.filter(i=>i[1].el.classList.contains("cut"));if(!t.length&&!o.length)return;let n=(s=De(e))!=null?s:"./";try{for(let i of t)await oe(e,i,n,"copy");for(let i of o)await oe(e,i,n,"cut")}catch(i){console.error("Operation cancelled due to error:",i),new f.Notice("Operation failed. Check console for details.")}}async function oe(e,r,t,o){let n=r[0],s=h.join(t,h.basename(n));if(n===s){new f.Notice("Same path",2e3);return}if(Le(t,n)){new f.Notice("Cannot paste into a subpath",2e3);return}if(await e.app.vault.adapter.exists(s)){if(!await I("File or Folder already exists. Increment name or cancel"))return;s=Oe(e,r[1].file instanceof f.TFile?"file":"folder",s)}o==="copy"?await Ne(e,r,s):await Ae(e,r,s),r[1].el.classList.remove(o)}function Le(e,r){let t=e.split("/"),o=r.split("/");return t.length<o.length?!1:t.slice(0,o.length).join("/")===r}async function Ne(e,r,t){r[1].file instanceof f.TFile?await e.app.vault.copy(r[1].file,t):await ie(e,r[1].file,t)}async function ie(e,r,t){await e.app.vault.createFolder(t);for(let o of r.children){let n=(0,f.normalizePath)(h.join(t,o.name));o instanceof f.TFile?await e.app.vault.copy(o,n):await ie(e,o,n)}}async function Ae(e,r,t){r[1].file instanceof f.TFile?await e.app.fileManager.renameFile(r[1].file,t):await e.app.vault.rename(r[1].file,t)}function De(e,r=!1){let t=p(e);if(!t)return;let o=u(t);return h.extname(o)?h.dirname(o):o}function Oe(e,r,t){let{dir:o,name:n,ext:s}=Y(t),i=o==="."?"":o+"/",l=n||"Untitled",a=r==="file"?s||".md":"",c=-1,m=l,C=(0,f.normalizePath)(i+m+a),me=/^(Untitled)(\s*(\d+))?$/,pe=l.match(me);for(;e.app.vault.getAbstractFileByPath(C);)c++,pe?m=c===0?"Untitled":`Untitled ${c}`:m=c===0?l:`${l} (${c})`,C=(0,f.normalizePath)(i+m+a);return C}async function se(e,r){let t=v(e);if(!t)return;let o=p(e);if(!o)return;let n=t.tree;if(!n)return;let s=u(o)||"/",i=t.fileItems[s];if(!i)return;n.setFocusedItem(i),n.handleRenameFocusedItem();let l=t.containerEl.querySelector('[contenteditable="true"]');l&&(l.onblur=function(){var a;e.renaming=!1,(a=o.firstElementChild)==null||a.classList.remove("has-focus")})}function le(){let e=document.querySelector('.nav-action-button[aria-label="Collapse all"]');if(e||(e=document.querySelector('.nav-action-button[aria-label="Expand all"]')),!e)return;let r=new MouseEvent("click",{bubbles:!0,cancelable:!0,view:window});e.dispatchEvent(r)}async function ae(e){let r=e.app.commands.executeCommandById("file-explorer:reveal-active-file"),t=e.app.commands.executeCommandById("file-explorer:reveal-active-file");await Promise.all([r,t]),setTimeout(async()=>{e.app.workspace.setActiveLeaf(e.app.workspace.getLeaf(!1),{focus:!0})},50)}async function ce(e){var t,o,n;if(!w(this))return;if(((t=this.elementFromPoint)==null?void 0:t.closest(".is-being-renamed"))&&this.blockedKeys[e.key]&&delete this.blockedKeys[e.key],e.key==="Escape"&&J(this),this.renaming){this.blockedKeys={};return}e.key==="ArrowLeft"&&le(),e.key==="ArrowRight"&&await ae(this),(o=this.elementFromPoint)!=null&&o.closest(".nav-files-container")&&(e.key==="ArrowUp"&&await O(this,"up"),e.key==="ArrowDown"&&await O(this,"down"),(n=this.elementFromPoint)!=null&&n.closest(".tree-item")&&((e.key==="r"||e.key==="F2")&&(this.renaming=!0,await se(this,e)),e.key==="n"&&await M(this,"file"),e.key==="f"&&await M(this,"folder"),e.key==="x"&&W(this),e.key==="c"&&z(this),e.key==="v"&&await ne(this),e.key==="Delete"&&(await Z(this,e),ee(this,e))))}function fe(e){w(this)&&(this.renaming||Me(e.key)&&(e.preventDefault(),this.blockedKeys[e.key]=!0))}function Me(e){return["n","r","x","c","q","v","d","ArrowUp","ArrowDown","ArrowLeft","ArrowRight","f","F2","Escape","Delete"].includes(e)}var k=class extends ue.Plugin{constructor(){super(...arguments);this.elementFromPoint=null;this.explorerfileContainer=null;this.explorerfolderContainer=null;this.renaming=!1;this.blockedKeys={};this.operation=null}async onload(){await this.loadSettings(),this.addSettingTab(new b(this.app,this)),this.app.workspace.onLayoutReady(this.onLayoutReady.bind(this))}onLayoutReady(){this.registerDomEvents()}registerDomEvents(){this.registerDomEvent(document,"mousemove",Ke.bind(this)),this.registerDomEvent(document,"keydown",fe.bind(this),!0),this.registerDomEvent(document,"keyup",async t=>await ce.call(this,t))}async loadSettings(){this.settings=Object.assign({},H,await this.loadData())}async saveSettings(){await this.saveData(this.settings)}};function Ke(e){this.elementFromPoint=R(this,e),w(this)&&(this.explorerfolderContainer=j(this),this.explorerfileContainer=q(this))}
