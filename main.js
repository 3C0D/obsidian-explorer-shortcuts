/*
THIS IS A GENERATED/BUNDLED FILE BY ESBUILD
if you want to view the source, please visit the github repository of this plugin
*/
var we=Object.create;var C=Object.defineProperty;var ye=Object.getOwnPropertyDescriptor;var Se=Object.getOwnPropertyNames;var be=Object.getPrototypeOf,Fe=Object.prototype.hasOwnProperty;var Ie=(e,o)=>{for(var t in o)C(e,t,{get:o[t],enumerable:!0})},$=(e,o,t,n)=>{if(o&&typeof o=="object"||typeof o=="function")for(let r of Se(o))!Fe.call(e,r)&&r!==t&&C(e,r,{get:()=>o[r],enumerable:!(n=ye(o,r))||n.enumerable});return e};var M=(e,o,t)=>(t=e!=null?we(be(e)):{},$(o||!e||!e.__esModule?C(t,"default",{value:e,enumerable:!0}):t,e)),Ce=e=>$(C({},"__esModule",{value:!0}),e);var tt={};Ie(tt,{default:()=>O});module.exports=Ce(tt);var Ee=require("obsidian");var j={focusNeeded:!0,delConfirmFile:!0,delConfirmFolder:!0};var b=require("obsidian");var P=class extends b.PluginSettingTab{constructor(t,n){super(t,n);this.plugin=n;this.plugin=n}display(){let{containerEl:t}=this;t.empty(),new b.Setting(t).setName("Confirm before deleting files").setDesc("Warning: Disabling this is dangerous as you can easily delete the wrong hovered file without confirmation.").addToggle(n=>n.setValue(this.plugin.settings.delConfirmFile).onChange(async r=>{this.plugin.settings.delConfirmFile=r,await this.plugin.saveSettings()})),new b.Setting(t).setName("Confirm before deleting folders (when not empty)").setDesc("Warning: Disabling this is dangerous as you can easily delete the wrong hovered folder without confirmation.").addToggle(n=>n.setValue(this.plugin.settings.delConfirmFolder).onChange(async r=>{this.plugin.settings.delConfirmFolder=r,await this.plugin.saveSettings()}))}};var x=M(require("path"),1);function f(e){return e?.children[0]?.getAttribute("data-path")??e?.getAttribute("data-path")??""}function p(e){return e.explorerfileContainer||e.explorerfolderContainer||null}function W(e,o){return e.mousePosition={x:o.clientX,y:o.clientY},e.mousePosition?document.elementFromPoint(e.mousePosition.x,e.mousePosition.y):null}function R(e,o){return e?.classList.contains(o)??!1}var X=e=>R(e,"nav-file"),V=e=>R(e,"is-collapsed"),_=e=>R(e,"nav-folder"),Y=e=>e.elementFromPoint?.closest(".nav-file")??null,G=e=>e.elementFromPoint?.closest(".nav-folder")??null;function T(){return document.querySelectorAll(".nav-files-container .nav-file, .nav-files-container .nav-folder")}async function F(e){return new Promise(o=>{setTimeout(()=>{let t=Pe(e);if(!t)return o();t.scrollIntoView({behavior:"smooth",block:"center"}),o()},100)})}function z(e){return w(e).find(t=>t[1].selfEl.classList.contains("is-active"))??null}function B(e,o){let t=f(o),n=w(e);if(n){for(let r of n)if(r[0].includes(t)){"setCollapsed"in r[1]&&r[1].setCollapsed(!1,!0);break}}}var v=e=>e.elementFromPoint?.closest(".workspace-leaf-content[data-type='file-explorer'] .nav-files-container")||null;function E(e){let{workspace:o}=e.app;return o.getLeavesOfType("file-explorer")?.first()?.view}function w(e){let o=E(e);return o?.fileItems?Object.entries(o.fileItems):[]}function Pe(e){return E(e)?.containerEl.querySelector(".is-active")??null}function J(e){return{dir:x.dirname(e),name:x.basename(e,x.extname(e)),ext:x.extname(e)}}function Q(e,o){e.operation=o;let t=Te(e);e.taggedItems||(e.taggedItems=new Set);let n=p(e);n&&e.taggedItems&&e.taggedItems.has(n)?(e.taggedItems.delete(n),n.classList.remove("copy","cut")):t.length>1?t.forEach(r=>{e.taggedItems?.add(r),r.classList.remove("copy","cut"),r.classList.add(o)}):n&&e.taggedItems&&(e.taggedItems.add(n),n.classList.remove("copy","cut"),n.classList.add(o))}function Z(e){Q(e,"copy")}function ee(e){Q(e,"cut")}function te(e){T().forEach(t=>{t.classList.remove("copy","cut")}),e.operation=null,e.taggedItems&&e.taggedItems.clear()}function Te(e){let o=e.app.workspace.getLeavesOfType("file-explorer")[0];if(!o)return[];let t=o.view;if(!t)return[];let n=[],r=t.fileItems,s=[];for(let i in r){let a=r[i];if(!a?.el)continue;let m=!1;if(a.el.classList.contains("is-selected"))m=!0;else{let d=a.el.querySelector(".nav-file-title, .nav-folder-title");(d&&d.classList.contains("is-selected")||a.el.querySelector(".is-selected"))&&(m=!0)}if(m){let d=a.el.classList.contains("nav-folder");s.push({path:i,element:a.el,isFolder:d})}}if(s.length===1)return[s[0].element];let l=s.filter(i=>!i.isFolder).map(i=>i.path);if(l.length>0)for(let i of s)i.isFolder&&l.some(m=>m.startsWith(i.path+"/"))||n.push(i.element);else n.push(...s.map(i=>i.element));return n}var g=require("obsidian");var y=require("obsidian"),U=class extends y.Modal{constructor(t,n,r){super(t);this.message=n;this.callback=r;this.scope=new y.Scope(this.scope),this.scope.register([],"Enter",()=>{this.confirm(!0)})}confirm(t){this.callback(t),this.close()}onOpen(){let{contentEl:t}=this;t.empty(),t.createEl("p").setText(this.message),new y.Setting(this.contentEl).addButton(n=>{n.setIcon("checkmark").setCta().onClick(()=>this.confirm(!0))}).addExtraButton(n=>n.setIcon("cross").onClick(()=>this.confirm(!1)))}onClose(){let{contentEl:t}=this;t.empty()}};async function ke(e,o){return await new Promise(t=>{new U(e,o,n=>{t(n)}).open()})}async function oe(e){return await ke(this.app,e)}function ne(e){let o=["Space + Up/Down Arrow: Navigate between files and folders","Space + Left Arrow: Toggle collapse/expand all folders","Space + Right Arrow: Reveal the active file","F2 or Space + R: Rename the selected file/folder","Space + N: Create a new file","Space + F: Create a new folder","Space + X: mark(color) the hovered file/folder as cut (Press again to unmark)","Space + C: mark(color) the hovered file/folder as copy (Press again to unmark)","Space + V: Paste what have been marked as cut/copy to the hovered item (parent folder if file)","Esc: Cancel all cut/copy markings","Space + Delete: Delete the hovered file/folder (with confirmation or not depending on settings)","Space + W: Open the hovered file in a new window","Space + O: Open the hovered file/folder/root in the system explorer","Space + H: Show this help modal"],t=new y.Modal(e);t.titleEl.textContent="Explorer shortcuts reminder",t.contentEl.innerHTML=o.map(n=>`<p>${n}</p>`).join(""),t.open()}async function ie(e,o){let t=!0,n=E(e),r=n?.tree;if(!r)return;let s=p(e),l=f(s)||"/",i=n.fileItems[l];if(!i)return;let a=i.file;if(a instanceof g.TFile&&i.el.children[0].classList.contains("has-focus")||(e.settings.delConfirmFile&&a instanceof g.TFile?t=await re(a):e.settings.delConfirmFolder&&a instanceof g.TFolder&&(a.children.length===0||(t=await re(a))),!t))return;r.selectItem(i),r.handleDeleteSelectedItems(o);let m=a instanceof g.TFile?"File":"Folder";new g.Notice(`${m} removed: `+a.name,3500)}async function re(e){return oe(" Are you sure you want to delete "+e.name+"?")}function se(e,o){let t=new MouseEvent("mousemove",{clientX:e.mousePosition.x+1,clientY:e.mousePosition.y+1});setTimeout(()=>{document.dispatchEvent(t)},70)}var ae=require("obsidian");var le=0,Le=200,k=null,Ae=500;function Ne(e){k&&clearTimeout(k),k=setTimeout(()=>{let o=new MouseEvent("mousemove",{clientX:e.mousePosition.x+1,clientY:e.mousePosition.y+1});document.dispatchEvent(o),k=null},Ae)}async function H(e,o="down"){let t=Date.now();if(t-le<Le)return;le=t,await De(e);let n=Oe(e,o);if(!n){new ae.Notice("End of list",800);return}X(n)?await Ke(e,n):await F(e),Ne(e)}async function De(e){let o=z(e);if(!o)return;let[t,n]=o;for(let r=0;r<2;r++){let s=w(e);for(let[l,i]of s)t.startsWith(l)&&V(i.el)&&"setCollapsed"in i&&i.setCollapsed(!1,!0);await new Promise(l=>setTimeout(l,50))}await F(e)}function Oe(e,o){let t=L();if(t.length===0)return;let n=Re(t);if(n===-1){if(n=Me(e),n===-1)return;t=L()}return Ve(e,t,n,o)}function Me(e){let o=w(e),n=(e.app.workspace.getLeaf(!1)?.view).file;if(!n)return-1;let r=n.path,s=o.find(i=>i[0]===r);return s?(B(e,s[1].el),L().findIndex(i=>i.children[0].classList.contains("is-active"))):-1}function L(){let e=T();return Array.from(e).filter(o=>!o.children[0].classList.contains("is-unsupported")&&!o.classList.contains("mod-root"))}function Re(e){return e.findIndex(o=>o.children[0].classList.contains("is-active"))}function A(e,o,t){return t==="down"?(e+1)%o:(e-1+o)%o}function Ve(e,o,t,n){let r=o,s=A(t,r.length,n),l=r[s];for(;_(l);){if(V(l)){let{newIndex:i,newList:a}=Be(e,l,r,s,n);s=i,r=a}else s=A(s,r.length,n);l=r[s]}return l}function Be(e,o,t,n,r){let s=t.length;B(e,o);let l=L(),a=l.length-s,m=l.indexOf(o),d;return r==="down"?d=a===0?A(n,l.length,r):m+1:d=a===0?A(n,l.length,r):m+a,{newIndex:d,newList:l}}function Ue(){document.querySelectorAll(".nav-file-title.has-focus, .nav-folder-title.has-focus").forEach(o=>{o.classList.remove("has-focus")})}async function He(e){try{e.app.commands.executeCommandById("file-explorer:reveal-active-file"),e.app.commands.executeCommandById("file-explorer:reveal-active-file"),await new Promise(o=>setTimeout(o,100))}catch(o){console.error("Failed to reveal active file:",o)}}async function Ke(e,o){let t=f(o);if(!t)return;let n=e.app.vault.getFileByPath(t);if(!n)return;let r=e.app.workspace.getLeaf(!1);if(!r)return;Ue(),F(e),await r.openFile(n),await new Promise(l=>setTimeout(l,100)),await He(e),await F(e);let s=e.app.workspace.getLeavesOfType("file-explorer")[0];s&&e.app.workspace.setActiveLeaf(s,{focus:!0})}var N=require("obsidian");async function K(e,o){let t=E(e);if(!t)return;let n=p(e),r=f(n)||"/",s;if(r==="/")s=e.app.vault.getRoot();else{let i=t.fileItems[r].file;i instanceof N.TFile?s=i.parent||e.app.vault.getRoot():i instanceof N.TFolder?s=i:s=e.app.vault.getRoot()}if(e.isEditingNewItem=!0,t.createAbstractFile(o,s,!0),o==="file"){let l=setInterval(()=>{let i=document.querySelector(".inline-title");i&&(clearInterval(l),i.addEventListener("blur",()=>{e.isEditingNewItem=!1,setTimeout(()=>{let a=e.app.workspace.getLeavesOfType("file-explorer")[0];a&&e.app.workspace.setActiveLeaf(a,{focus:!0})},100)},{once:!0}),i.addEventListener("keydown",a=>{a.key==="Enter"&&(a.preventDefault(),i.blur())}))},50)}else{let l=setInterval(()=>{let i=t.containerEl.querySelector('[contenteditable="true"]');i&&(clearInterval(l),i.addEventListener("blur",()=>{e.isEditingNewItem=!1,t.containerEl.querySelectorAll(".has-focus").forEach(a=>{a.classList.remove("has-focus")})},{once:!0}))},50)}setTimeout(()=>{e.isEditingNewItem=!1,t.containerEl.querySelectorAll(".has-focus").forEach(l=>{l.classList.remove("has-focus")})},1e4)}var c=require("obsidian"),u=M(require("path"),1);var I=!1;async function ce(e){let t=w(e).filter(r=>r[1].el.classList.contains("copy")||r[1].el.classList.contains("cut"));if(!t.length){new c.Notice("No items selected for paste operation");return}if(t.length>1){let r=t.filter(s=>!s[1].el.classList.contains("nav-folder")).map(s=>s[0]);r.length>0&&(t=t.filter(s=>s[1].el.classList.contains("nav-folder")?!r.some(a=>a.startsWith(s[0]+"/")):!0))}let n=_e(e)??"/";try{I=!1;let r=await qe(e,t,n),s=null;for(let l of t){let i=l[0],a=u.join(n,u.basename(i)),m=l[1].el.classList.contains("copy")?"copy":"cut",d=!1;if(r.includes(i))if(!I||s===null){let h=await $e(e.app,u.basename(i),r.length);if(h==="cancel")continue;I&&(s=h),d=h==="replace"}else d=s==="replace";await je(e,l,a,m,d)}e.taggedItems&&e.taggedItems.clear(),e.operation=null}catch(r){console.error("Paste operation failed:",r),new c.Notice("Paste operation failed. Check console for details.")}}async function qe(e,o,t){let n=[];for(let r of o){let s=u.join(t,u.basename(r[0]));await e.app.vault.adapter.exists(s)&&n.push(r[0])}return n}async function $e(e,o,t){return new Promise(n=>{let r=new c.Modal(e);r.titleEl.textContent=`File "${o}" already exists`;let s="increment";new c.Setting(r.contentEl).setName("Choose Action").addDropdown(l=>{l.addOption("increment","Increment name").addOption("replace","Replace existing").setValue("increment").onChange(i=>{s=i})}),t>1&&new c.Setting(r.contentEl).setName("Apply to all remaining files").addToggle(l=>{l.setValue(I).onChange(i=>{I=i})}),new c.Setting(r.contentEl).addButton(l=>{l.setButtonText("OK").setCta().onClick(()=>{n(s),r.close()})}).addButton(l=>{l.setButtonText("Cancel").onClick(()=>{n("cancel"),r.close()})}),r.open()})}async function je(e,o,t,n,r){let s=o[0];if((0,c.normalizePath)(s)===(0,c.normalizePath)(t)){new c.Notice("Cannot paste to the same location",2e3);return}r||(t=Ye(e,o[1].file instanceof c.TFile?"file":"folder",t));try{n==="copy"?await We(e,o,t,r):await Xe(e,o,t,r),o[1].el.classList.remove(n)}catch(l){console.error(`Failed to ${n} item:`,l),new c.Notice(`Failed to ${n} item. Check console for details.`)}}async function We(e,o,t,n){let r=o[1].file;if(r instanceof c.TFile)if(n){let s=await e.app.vault.adapter.read(r.path);await e.app.vault.adapter.write(t,s)}else await e.app.vault.copy(r,t);else await me(e,r,t,n)}async function me(e,o,t,n){n&&await e.app.vault.adapter.rmdir(t,!0),await e.app.vault.createFolder(t);for(let r of o.children){let s=(0,c.normalizePath)(u.join(t,r.name));r instanceof c.TFile?await e.app.vault.copy(r,s):r instanceof c.TFolder&&await me(e,r,s,n)}}async function Xe(e,o,t,n){o[1].file instanceof c.TFile?(n&&await e.app.vault.adapter.remove(t),await e.app.fileManager.renameFile(o[1].file,t)):await e.app.vault.rename(o[1].file,t)}function _e(e,o=!1){let t=p(e);if(!t)return;let n=f(t);return u.extname(n)?u.dirname(n):n}function Ye(e,o,t){let{dir:n,name:r,ext:s}=J(t),l="";n&&n!=="."&&n!=="/"&&(l=n.endsWith("/")?n:n+"/");let i=r||"Untitled",a=o==="file"?s||".md":"",m=-1,d=i,h=(0,c.normalizePath)(l+d+a),ge=/^(Untitled)(\s*(\d+))?$/,xe=i.match(ge);for(;e.app.vault.getAbstractFileByPath(h);)m++,xe?d=m===0?"Untitled":`Untitled ${m}`:d=m===0?i:`${i} (${m})`,h=(0,c.normalizePath)(l+d+a);return h}async function de(e,o){let t=E(e);if(!t)return;let n=p(e);if(!n)return;let r=t.tree;if(!r)return;let s=f(n)||"/",l=t.fileItems[s];l&&(r.setFocusedItem(l),r.handleRenameFocusedItem(o),setTimeout(()=>{let i=t.containerEl.querySelector('[contenteditable="true"]');i&&(i.addEventListener("blur",()=>{e.renaming=!1,n.firstElementChild?.classList.remove("has-focus")},{once:!0}),i.addEventListener("keydown",a=>{a.key==="Enter"&&(e.renaming=!1,n.firstElementChild?.classList.remove("has-focus"))},{once:!0}),setTimeout(()=>{e.renaming&&(e.renaming=!1,n.firstElementChild?.classList.remove("has-focus"))},1e4))},50))}var Ge=50;function fe(e){let o=document.querySelector('.nav-action-button[aria-label="Collapse all"]'),t=document.querySelector('.nav-action-button[aria-label="Expand all"]'),n=o||t;if(n){let r=new MouseEvent("click",{bubbles:!0,cancelable:!0,view:window});n.dispatchEvent(r),ze(e)}else console.warn("Toggle collapse/expand button not found")}function ze(e){let o=new MouseEvent("mousemove",{clientX:e.mousePosition.x+1,clientY:e.mousePosition.y+1});setTimeout(()=>{document.dispatchEvent(o)},70)}function pe(e){try{e.app.commands.executeCommandById("file-explorer:reveal-active-file"),e.app.commands.executeCommandById("file-explorer:reveal-active-file"),setTimeout(()=>{let o=e.app.workspace.getLeaf(!1);o?e.app.workspace.setActiveLeaf(o,{focus:!0}):console.warn("No active leaf found")},Ge)}catch(o){console.error("Failed to reveal active file:",o)}}var S=M(require("path"),1);async function ue(e,o=!1){if(!o)return;let t="/",n=p(e);n&&(t=f(n)),Je.call(e,t)}async function Je(e){let o=window.electron.shell;S.extname(e)!==""&&(e=S.dirname(e));let t=e,n=this.app.vault.adapter.basePath;t=S.join(n,e);try{await o.openPath(t)}catch(r){console.log(r)}}var D=require("obsidian"),q=!1;async function he(e){if(v(this)||(this.pendingSpaceCombos={},this.spacePressed=!1),!q||!v(this))return;if(this.elementFromPoint?.closest(".is-being-renamed")&&this.blockedKeys[e.key]&&delete this.blockedKeys[e.key],e.key==="Escape"&&(te(this),this.pendingSpaceCombos={},this.spacePressed=!1),this.renaming||this.isEditingNewItem){this.blockedKeys={},this.pendingSpaceCombos={},this.spacePressed=!1;return}v(this)&&(e.key==="ArrowLeft"&&this.pendingSpaceCombos.ArrowLeft&&(this.pendingSpaceCombos.ArrowLeft=!1,fe(this)),e.key==="ArrowRight"&&this.pendingSpaceCombos.ArrowRight&&(this.pendingSpaceCombos.ArrowRight=!1,pe(this)),e.key==="ArrowUp"&&this.pendingSpaceCombos.ArrowUp&&(this.pendingSpaceCombos.ArrowUp=!1,await H(this,"up")),e.key==="ArrowDown"&&this.pendingSpaceCombos.ArrowDown&&(this.pendingSpaceCombos.ArrowDown=!1,await H(this,"down")),e.key==="n"&&this.pendingSpaceCombos.n&&(this.pendingSpaceCombos.n=!1,await K(this,"file")),e.key==="f"&&this.pendingSpaceCombos.f&&(this.pendingSpaceCombos.f=!1,await K(this,"folder")),e.key==="o"&&this.pendingSpaceCombos.o&&(this.pendingSpaceCombos.o=!1,await ue(this,!0)),e.key==="h"&&this.pendingSpaceCombos.h&&(this.pendingSpaceCombos.h=!1,ne(this.app)),e.key==="x"&&this.pendingSpaceCombos.x&&(this.pendingSpaceCombos.x=!1,ee(this)),e.key==="c"&&this.pendingSpaceCombos.c&&(this.pendingSpaceCombos.c=!1,Z(this)),e.key==="v"&&this.pendingSpaceCombos.v&&(this.pendingSpaceCombos.v=!1,await ce(this)),e.key==="Delete"&&this.pendingSpaceCombos.Delete&&(this.pendingSpaceCombos.Delete=!1,await ie(this,e),se(this,e))),this.elementFromPoint?.closest(".tree-item")&&(v(this)&&((e.key==="r"&&this.pendingSpaceCombos.r||e.key==="F2")&&(e.key==="r"&&(this.pendingSpaceCombos.r=!1),this.renaming=!0,await de(this,e)),e.key==="w"&&this.pendingSpaceCombos.w&&(this.pendingSpaceCombos.w=!1,await Ze(this))),e.key===" "&&(this.spacePressed=!1))}function ve(e){if(!(!v(this)||document.querySelector(".modal"))){if(this.renaming||this.isEditingNewItem){e.preventDefault(),e.stopPropagation();return}if(e.key===" "&&(this.spacePressed=!0),this.spacePressed&&["n","f","r","v","w","h","o","x","c","Delete","ArrowUp","ArrowDown","ArrowLeft","ArrowRight"].includes(e.key)&&(this.pendingSpaceCombos[e.key]=!0),Qe(e.key,this.spacePressed))e.preventDefault(),this.blockedKeys[e.key]=!0,q=!0;else{q=!1;return}}}function Qe(e,o){let t=["F2","Escape"," "],n=["n","r","v","f","w","h","o","x","c","Delete","ArrowUp","ArrowDown","ArrowLeft","ArrowRight"];return t.includes(e)||o&&n.includes(e)}async function Ze(e){let o=p(e);if(!o)return;let t=f(o);if(!t)return;let n=e.app.vault.getAbstractFileByPath(t);if(!(n instanceof D.TFile))return;let r=e.app.workspace.getLeaf("window");if(r)try{await r.openFile(n)}catch{new D.Notice("Failed to open file in new window")}}var O=class extends Ee.Plugin{constructor(){super(...arguments);this.elementFromPoint=null;this.explorerfileContainer=null;this.explorerfolderContainer=null;this.renaming=!1;this.isEditingNewItem=!1;this.blockedKeys={};this.pendingSpaceCombos={};this.spacePressed=!1;this.operation=null;this.taggedItems=null}async onload(){console.log("Loading Explorer Shortcuts"),await this.loadSettings(),this.addSettingTab(new P(this.app,this)),this.app.workspace.onLayoutReady(this.registerDomEvents.bind(this))}registerDomEvents(){this.registerDomEvent(document,"mousemove",et.bind(this)),this.registerDomEvent(document,"keydown",ve.bind(this),!0),this.registerDomEvent(document,"keyup",async t=>await he.call(this,t))}async loadSettings(){this.settings=Object.assign({},j,await this.loadData())}async saveSettings(){await this.saveData(this.settings)}};function et(e){this.elementFromPoint=W(this,e),v(this)&&(this.explorerfolderContainer=G(this),this.explorerfileContainer=Y(this))}
